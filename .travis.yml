language: cpp

env:
 - BUILD_TYPE=Debug
 - BUILD_TYPE=Release

compiler:
 - clang
 - gcc

before_install:
 - sudo apt-get update -qq
 - sudo apt-get install -y valgrind
 - cd ${TRAVIS_BUILD_DIR}
 - cd Build
 - wget http://ftp.de.debian.org/debian/pool/main/l/lcov/lcov_1.11.orig.tar.gz
 - tar xf lcov_1.11.orig.tar.gz
 - sudo make -C lcov-1.11/ install
 - gem install coveralls-lcov

install:
 - cmake -H./ -BBuild -DCMAKE_BUILD_TYPE=$BUILD_TYPE -DCOVERAGE=ON
 - cd Build
 - make
 - cd ..

script:
 - cd Build/Output
 - ./nominaltests
 - valgrind ./nominaltests

after_success:
 - cd Build
 - lcov --directory . --capture --output-file coverage.info
 - lcov --list coverage.info
 - coveralls-lcov --repo-token MYf22tqc34UQdRLeglOuMI7jTI5mx6Y99 coverage.info
 - cd ..
